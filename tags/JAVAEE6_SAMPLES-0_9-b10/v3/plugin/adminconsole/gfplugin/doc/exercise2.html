<html>
    <head></head>
    <body>
	<div class="j1holcontents">

	    <h1>Exercise 2: Charting with jMaki</h1>

	    <div class="j1holduration xbig">Approximate duration: 25 minutes</div>

	    <p class="j1holheader">Introduction:</p>

	    <p> The goal of this exercise is to create a JSF page which
		utilizes the jMaki Charting component and link the page to the
		GlassFish Administration Console by adding another tree node in
		the GlassFish Administration Console.  When you have completed
		this exercise, your plugin will resemble the following
		image:</p>

	    <p> <img src="images/ex2-result.jpg"></p>
	    <div class="figure">Figure 2-1: Browser showing the plugin page with charts.</div>

	    <p> In this exercise you will learn the following concepts:</p>

	    <ul class="j1hollist">
		<li>How to add jMaki widget to a JSF page.</li>
		<li>How to add a plugin to the Administration Console that
		    links to another plugin <code>IntegrationPoint</code>.</li>
	    </ul>

	    <p>	To learn background information about jMaki, proceed to the
		<a href="#ex2background">next section</a>.  To begin creating
		the jMaki Charting JavaServer Faces page immediately, proceed
		to the <a href="#ex2steps">Step-by-Step Instructions</a>.</p>

<a name="ex2background">
	    <p class="j1holheader">Background Information:</p>
</a>
	    <div class="j1holsubheader">jMaki</div>

	    <p> jMaki is a lightweight client/server framework for creating
		JavaScript centric Web 2.0 applications using CSS layouts,
		widgets widget model, client services such as publish /
		subscribe events to tie widgets together, JavaScript action
		handlers, and a generic proxy to interact with external RESTful
		web services. While jMaki abstracts much of the JavaScript and
		CSS by providing defaults for widgets, the JavaScript widgets
		and CSS are made easily accessible so they may be customized by
		a designer or page developer. jMaki focuses on the aspects of
		delivering JavaScript to the client allowing the JavaScript to
		communicate to various server-technologies including PHP,
		JavaServer Pages, JavaServer Faces, and Phobos in a
		server-technology neutral way.</p>

	    <p><img src="images/jmaki-architecture.jpg"></p>

	    <p>Following are the client and the server modules that make up jMaki.</p>

	    <div class="j1holsubheader">Client-side Components</div>

	    <ul span="j1hollist">
		<li><b>jMaki Layouts:</b> - <a href="https://ajax.dev.java.net/source/browse/*checkout*/ajax/ws/lib/css/index.html">jMaki Layouts</a> provide a standards based starting point for creating your web applications using HTML and CSS. The CSS is in plain view so it can be easily customized for your needs.</a>
		</li>

		<li><b>jMaki Client Runtime:</b> - The <a href="https://ajax.dev.java.net/jsdocs/Jmaki.html">jMaki Client Runtime</a>
		    is the JavaScript responsible for bootstrapping all widgets and passing parameters provided by a server-side
		    runtime to the widgets. Parameters are unique to each widget, and the JavaScript runtime makes sure that each
		    widget instance gets the correct parameters that were passed from the server-side runtime. In cases where
		    parameters are not provided the runtime uses default parameters that may then be customized for each widget.
		</li>
		<li><b>jMaki Client Services:</b>Services such convenient APIs for
		    performing XMLHttpRequest and publish subscribe on the client are provided
		    to all widgets as a means of communication.  jMaki glue is built on top of
		    <a href="https://ajax.dev.java.net/publishsubscribe.html">publish/subscribe</a> events.
		    <a href="https://ajax.dev.java.net/glue.html">jMaki Glue</a> is built on top
		    of the publish/subscribe mechanism. It allows you to define application
		    behavior and time widgets together widgets  using JavaScript actions when a
		    specific event is published to a topic. jMaki Timers allow JavaScript action
		    handlers to be called or events to be published at a set interval. The
		    <a href="https://ajax.dev.java.net/injector.html">jMaki Injector</a> is a client service that allows you
		    to bring in an external page into any given div element. The Injector transfers
		    scripts and CSS to the global page content and allows widgets to be loaded much
		    like an iframe without the usability issues.
		</li>
		<li><b>jMaki Widget Model</b> - The <a href="https://ajax.dev.java.net/widget-model.html">jMaki widget model</a>
		    provides a component model for reusable JavaScript components. The structure is
		    based on a HTML, JavaScript and CSS. You can use this structure to create your
		    own widgets or wrap widgets from any given toolkit. jMaki provides default
		    wrappers and a server tie-in for many commonly-used Dojo, Yahoo UI, Prototype,
		    and some native widgets. jMaki also defines a widget.json format which is a
		    common way of describing which so that they are accessible by tools.
		</li>
	    </ul>

	    <div class="j1holsubheader">Server Components</div>
	    <ul class="j1hollist">
		<li><b>jMaki Server Runtime</b> - The <a href="https://ajax.dev.java.net/images/jmaki-lifecycle.jpg">jMaki Server Runtime</a>
		    is responsible for tying the jMaki JavaScript Client Runtime to a server-side runtime such as Java, PHP, or
		    the JavaScript-based Phobos runtime. The server runtime tracks and renders all script
		    and CSS references based on library type being used making sure that the duplicate script and CSS
		    links are not duplicated. The server-runtime also makes sure API keys (such as Google and Yahoo Map keys)
		    are applied when necessary based on a configurable set of keys. The server runtime renders the HTML templates
		    making and serializes data in JavaScript such that each widget instance is provided the proper data.
		</li>
		<li><b>XmlHttpProxy</b> - The <a href="https://ajax.dev.java.net/xmlhttpproxy.html">XmlHttpProxy</a> module
		    provides a means for widgets to access JSON or XML access RESTful XML-based services outside of the web
		    application domain. Such services include RSS feeds, Yahoo services such as geocoding, Flickr image
		    searches, and many more to come.  The XmlHttpProxy allows widgets to access services in a uniform way by
		    providing XSL-to-JSON transformations that can be easily customized.</li>
	    </ul>

	    <p> For more developer information on jMaki, visit:
		<a href="https://ajax.dev.java.net/developer.html">https://ajax.dev.java.net/developer.html</a>.</p>

	    <div class="j1holsubheader">jMaki Charting</div>

	    <p>
	    jMaki charting is an extension of the jMaki project which provides
	    dynamic charting capabilities where charts can be manipulated on
	    the client without round trips to the server.
	    Chart manipulation is handled through the jMaki publish and
	    subscribe mechanism.  jMaki  provides a common API to the following
	    JavaScript Charting packages, Plotkit, Dojo, Yahoo and Google.
	    Developers can quickly represent their data using bar, line, or area
	    charts.
	    </p>

	    <p>
	    You will get to experiment with jMaki Charting in this lab.  If you
	    would like more details on jMaki Charting, visit:
	    <a href="https://jmaki-charting.dev.java.net">https://jmaki-charting.dev.java.net</a>.
	    </p>

<a name="ex2steps">
    <p class="j1holheader">Step-by-Step Instructions:</p>
</a>

<div class="j1holnote">You will need Exercise #1 completed in order to continue with Exercise #2.</div>
<ol class="j1hollist">
    <li>To use the solution application instead of your own application (which you should have completed in Exercise #1), execute the following commands from a terminal window:
    <div class="j1holwarn">Warning! By copying the solution you will no longer see any work you completed in exercise #1.  We recommend you complete exercise #1 instead.</div>
<div class="console"><pre>
mv gfplugin/myplugin gfplugin/myplugin.save
cp -r gfplugin/solution/myplugin/ex1 gfplugin/myplugin
</pre></div>
    </li>
</ol>

    <p class="j1holsubheader">Overview:</p>

<p> In this exercise, you will complete the following:</p>

    <ol class="j1hollist" style="list-style-type: upper-alpha;">
	<li><b><a href="#ex2stepA">Create a jMaki Charting page</a></b>
	    <p>
		You will create a JSFTemplating JavaServer Faces pages that contains a jMaki Charting component
	    </p></li>
	<li><b><a href="#ex2stepB">Modify your console-config.xml </a></b>
	    <p>
You will modify your configuration file to add a new <code>IntegrationPoint</code>
	    </p></li>
	<li><b><a href="#ex2stepC">Specify your Tree Node layout</a></b>
	    <p>
In this step you will add the file "treenode-ex2.jsf" for specifying the new tree node that points to the jMaki Charting page
	    </p></li>

	<li><b><a href="#ex2stepD">Build and Install your GlassFish v3 plugin</a></b>
	    <p>
In this step you will install and test your plugin.
	    </p></li>
    </ol>

<p class="j1holsubheader">Steps:</p>

	<a name="ex2stepA">
	    <b>A. Create a jMaki Charting page </b>
	</a>
<!-- FIXME: Explain what happens in this step -->

<a name="FigChartPage">
<div class="codebox">
<pre>
&lt;sun:page&gt;
&lt;sun:html&gt;
    &lt;sun:head title="chart" /&gt;
    &lt;sun:body&gt;
        &lt;sun:form id="form"&gt;

&lt;!-- Pie Chart --&gt;
&lt;sun:markup tag="div" style="width:380px; height: 310px;"&gt;
&lt;jmaki:widget name="jmaki.charting.plotkit.pie"
    args="{colorScheme:4}"
    value="{
    xAxis : {
        title : 'Months',
        labels : [
        {label : 'January'},
        {label : 'February'},
        {label : 'March'},
        {label : 'April'},
        {label : 'May'},
        {label : 'June'},
        {label : 'July'},
        {label : 'August'},
        {label : 'September'},
        {label : 'October'},
        {label : 'November'},
        {label : 'December'} ] },
    data : [ {
        label : 'Set 1',
        values : [25, 45, 25, 45, 50, 25, 35, 25, 25, 20, 35, 45]
        } ] }" /&gt;
&lt;/sun:markup&gt;

&lt;!-- Area Chart --&gt;
&lt;sun:markup tag="div" style="width: 500px; height: 280px;"&gt;
&lt;jmaki:widget name="jmaki.charting.dojo.area"
    value="{
        xAxis : {
            title : 'Months',
            labels : [{ label : 'January'},
                { label : 'February'},
                { label : 'March'},
                { label : 'April'},
                { label : 'May'},
                { label : 'June'},
                { label : 'July'},
                { label : 'August'},
                { label : 'September'},
                { label : 'October'},
                { label : 'November'},
                { label : 'December'} ] },
        yAxis : {
            title : 'Temperature',
            labels : [{ label : '0', value : 0},
                { label : '10s', value : 10},
                { label : '20s', value : 20},
                { label : '30s', value : 30},
                { label : '40s', value : 40},
                { label : '50s', value : 50} ] },
        data : [{label : 'Gray Series', values : [65, 45, 15, 45, 50, 25, 3, 25, 35, 27, 35, 39] },
                {label : 'Pink Series', values : [25, 45, 50, 5, 45, 35, 25, 35, 25, 29, 27, 25] },
                {label : 'Blue Series', values : [45, 50, 25, 35, 2, 45, 45, 55, 45, 47, 31, 41] },
                {label : 'Red Series',  values : [20, 12, 4, 7, 5, 19, 35, 11, 20, 30, 15, 7] } ] }"/&gt;
&lt;/sun:markup&gt;

        &lt;/sun:form&gt;
    &lt;/sun:body&gt;
&lt;/sun:html&gt;
&lt;/sun:page&gt;
</pre>
</div>
<br />
<div class="figure">Figure 2-2: chart.jsf</div>
</a>

    <ol class="j1hollist">
	<li><b>Open your project in NetBeans</b>

	    <p>You should have <code>myplugin</code> project still open in
NetBeans. If you have closed the project, follow these steps to open
it again.</p>

    <ol class="j1hollist">
	<li>Launch NetBeans IDE 6.0.</li>
	<li>Open <code>myplugin</code> module:
	    <ol class="j1hollis">
		<li> Choose <b>Open Project</b> from the File menu.</li>
		<li> Browse to <b>gfplugin</b> and select <b>myplugin</b> module.</li>
		<li> Press the <b>Open Project button</b>.  Your NetBeans <b>Projects</b> tab should show:
		    <p><img src="images/ex2-project-open.jpg"></p>
		    <div class="figure">Figure 2-3: Open myplugin module.</div>
		</li>
	    </ol>
	</li>
   </ol></li>
	<li><b>Create a jMaki Charting page</b>
	    <ol class="j1hollist">
		<li>Select "<b>Other Sources</b>" and then "<b>Resources</b>".</li>
		<li>Create an empty file named "<b>chart.jsf</b>".</li>
		<li>Use <a href="#FigChartPage">Figure 2.2</a> for the content of chart.jsf.
		    <p><img src="images/ex2-editChart.jpg"></p>
		    <div class="figure">Figure 2-4: Edit chart.jsf.</div>
		</li>
	    </ol>
	</li>
   </ol>


<hr style="WIDTH:100%; HEIGHT:2px"><br>

<a name="ex2stepB">
    <b>B. Modify your console-config.xml </b>
</a>
<p> You now need to add an <code>IntegrationPoint</code> for plugging the
    Exercise 2 tree node into the Administration Console. Each plugin module
    should have 1 <code>console-config.xml</code>, and you can specify as
    many <code>IntegrationPoint</code>s as needed in this configuration file.
    Since you already created this file in Exercise #1, all you need to do is
    edit it and add the second <code>IntegrationPoint</code>.  The Exercise 2
    tree node should be under the J1 TreeNode, so you must specify the
    <code>parentId</code> to be "<code>j1root</code>". You can refer to
    <a href="#figIntPoint">Figure 2-5</a> to see this.</p>

<a name="figIntPoint">
<div class="codebox">
  <pre>
&lt;integration-point 
    id="Another" 
    type="tree" 
    priority="230" 
    parentId="j1root" 
    content="treenode-ex2.jsf" 
/&gt;
</pre>
</div>
<br />
<div class="figure">Figure 2-5: New integration-point for console-config.xml</div>
</a>
</p>

    <ol class="j1hollist">
	<li>Double click on <code><b>console-config.xml</b></code> under
	    <code><b>Other Sources --&gt; resources --&gt; META-INF --&gt; admingui</b></code></li>

	<li>Add the <code>IntegrationPoint</code> declaration as shown in <a href="#figIntPoint">Figure 2-5</a> to your
	<code>console-config.xml</code> file.
	    <p><img src="images/ex2-editConfig.jpg"></p>
	    <div class="figure">Figure 2-6: Modified console-config.xml file.</div>
	</li>
    </ol>

<hr style="WIDTH:100%; HEIGHT:2px"><br>

<a name="ex2stepC">
    <b>C. Specify your Tree Node layout</a></b>
</a>

<p> You need to create <code>treenode-ex2.jsf</code>, which is specified as
    the "<code>content</code>" of your new <code>IntegrationPoint</code> in
    your <code>console-config.xml</code> file.  The
    <code>treenode-ex2.jsf</code> file will provide access to your new JSF
    jMaki Charting page.</p>

<a name="figNewTreeNode">
<div class="codebox">
<pre>
&lt;sun:treeNode
    id="second"
    text="Exercise #2"
    url="javaone/chart.jsf"
    imageURL="resource/images/instance.gif"
    target="main"
/&gt;
</pre>
</div>
<br />
<div class="figure">Figure 2-7: Modify treenode-ex2.jsf </div>
</a>
</p>

<ol class="j1hollist">
    <li>Select "<b>Other Sources</b>" and then "<b>Resources</b>".</li>
    <li>Create an empty file named "<b>treenode-ex2.jsf</b>".</li>
    <li>Edit <code><b>treenode-ex2.jsf</b></code> to specify the information
	regarding this second tree node.
	<p><img src="images/ex2-editTreenode.jpg"></p>
	<div class="figure">Figure 2-8: treenode-ex2.jsf</div>
    </li>
</ol>

<hr style="WIDTH:100%; HEIGHT:2px">

<a name="ex2stepD">
    <b>D. Build and Install your GlassFish v3 plugin</b>
</a>

<ol class="j1hollist">
    <li><p> <b>Build your plugin</b></p>

<div class="console"><pre>
cd gfplugin/myplugin
mvn install
</pre>
</div>

<p> After the above steps are finished, you will have the jar file named
		<code>gfplugin/myplugin/target/console-myplugin-1.0.jar</code>.
		This jar file is ready to be integrated into GlassFish.</span><br>
    </li>
    <li><p> <b>Install your plugin</b></p>

	<p> You now need a Terminal to enter some commands. Please bring
	    up a terminal window.</p>

	<p> The GlassFish v3 server is installed in the
	    <code>gfplugin/glassfish</code> directory.  The following steps
	    show you how to integrate and test your plugin module.</p>

	<ol class="j1hollist">
	    <li>Go to your <code>gfplugin</code> directory.
<div class="console">
<pre>
cd &lt;path-to-gfplugin&gt;
</pre>
</div>
		</li>
	    <li>Shut down the server which may have been started in
		<a href="#Exercise_1">Exercise 1</a>.
<div class="console">
<pre>
glassfish/bin/asadmin stop-domain
</pre>
</div>
	    </li>
	    <li>Integrate your plugin into GlassFish by copying it to the GlassFish modules directory:
<div class="console">
<pre>
cp myplugin/target/console-myplugin-1.0.jar glassfish/modules/console-myplugin-1.0.jar
</pre>
</div>
	    </li>
	    <li>Start GlassFish:<br>
<div class="console">
<pre>
glassfish/bin/asadmin start-domain
</pre>
</div>
	    </li>
            <li>In the browser enter the following URL to bring up the Administration Console:
                <div class="codebox"><pre>http://localhost:8080/admin</pre></div>

	    <li>Expand the JavaOne tree node in the navigation tree, note your
		new tree node "<code>Exercise #2</code>" has been added.  Click
		the "<code>Exercise #2</code>" tree node to display your chart
		page.
		<p> <img src="images/ex2-result.jpg"></p>
		<div class="figure">Figure 2-9: Browser showing the plugin page with charts.</div>
		</li>
	    </ol>

<hr style="WIDTH:100%; HEIGHT:2px"><br>

<p class="j1holheader">Summary:</p>

<p> In this exercise, you created a JSFTemplating page with jMaki Chart.  You
    added a new <code>IntegrationPoint</code> to your GlassFish plugin module
    which added an additional tree node. Clicking on this tree node navigated
    to your newly added chart page.</p>

	    <p><a href="#Solution_2">Go to solution</a></p>
	    <p><a href="#Exercise_1">Go back to previous exercise</a></p>
	    <p><a href="#Exercise_3">Go on to next exercise</a></p>
	</div>
    </body>
</html>
