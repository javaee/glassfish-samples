<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html lang="en">
<head>
  <title>The SSL-JAXWS Sample Application</title>
  <style type="text/css">
  body,th,td,p,div,span,a,ul,ul li, ol, ol li, ol li b, dl,h1,h2,h3,h4,h5,h6,li
  {font-family:geneva,helvetica,arial,"lucida sans",sans-serif; font-size:10pt}
  h1 {font-size:18pt}
  h2 {font-size:14pt}
  h3 {font-size:12pt}
  code,kbd,tt,pre {font-family:monaco,courier,"courier new";font-size:10pt;color:#666}
  li {padding-bottom: 8px}
  p.copy, p.copy a {font-family:geneva,helvetica,arial,"lucida sans",sans-serif; font-size:8pt}
  p.copy {text-align: center}
  </style>
</head>
<body style="color: rgb(0, 0, 0); background-color: rgb(255, 255, 255);"
 alink="#333366" link="#594fbf" marginwidth="10" vlink="#1005fb">
<table border="0" cellpadding="2" cellspacing="4" width="100%">
  <tbody>
    <tr>
      <td align="right" bgcolor="#587993" valign="top"> <font
 color="#ffffff" size="-1"><b>Sun Java System Application Server</b></font>&nbsp;
      </td>
    </tr>
  </tbody>
</table>
<!---- Don't modify anything above this line, except for the title tag -------->
<p><a href="../../../docs/list.html">Samples Index</a></p>
<h1>The SSL-JAXWS-EAR Sample Application</h1>
This sample demonstrates the creation of a secure JAXWS web service
endpoint (https) and access it using java application client. The
service is protected at transport level and accessed by performing SSL
server side
authentication<br>
<br>
The
sample is a TAX calculation service and demos the above use case.
Following describes the steps to secure web service.<br>
<br>
<ul>
  <li><a href="#secure">Secure the web service endpoint at transport
level (https)</a> </li>
  <li><a href="#gen_artifacts">Generation of Artifacts when endpoint
is secured using https</a></li>
  <li><a href="#runtime">Runtime enviornment of&nbsp; the AppClient
during&nbsp; secured
https access to WS<br>
    </a></li>
  <li><a href="#sources_build">Source code and instructions for
building and running the sample</a><br>
  </li>
</ul>
<br>
<p></p>
<h2><a name="secure"></a>Secure the webservice endpoint at transport
level (https)</h2>
In order to protect the webservice endpoint at transport level, the
javaee web application's runtime xml (sun-web.xml) should have the <transport-gaurantee>
element, &lt;transport-guarantee&gt; . Here, webservice-endpoint should
match with above JAX-WS endpoint. <br>
<br>
See the snapshot used in the sample.<br>
</transport-gaurantee>
<p><code> </code></p>
<pre>        &lt;?xml version="1.0" encoding="UTF-8"?&gt;<br>        &lt;!DOCTYPE sun-web-app PUBLIC "-//Sun Microsystems, Inc.//DTD Application Server 9.0 Servlet 2.5//EN" "http://www.sun.com/software/appserver/dtds/sun-web-app_2_5-0.dtd"&gt;<br>        &lt;sun-web-app error-url=""&gt;<br>            &lt;context-root&gt;ssl-jaxws&lt;/context-root&gt;<br>            &lt;servlet&gt;<br>                &lt;servlet-name&gt;Tax&lt;/servlet-name&gt;<br>                &lt;webservice-endpoint&gt;<br>                    &lt;!-- default name is namePort --&gt;<br>                    &lt;port-component-name&gt;Tax&lt;/port-component-name&gt;<br>                    &lt;!-- default name service_name/name --&gt;<br>                    &lt;endpoint-address-uri&gt;TaxService&lt;/endpoint-address-uri&gt;<br>                    <b>&lt;transport-guarantee&gt;CONFIDENTIAL&lt;/transport-guarantee&gt;</b>
                &lt;/webservice-endpoint&gt;
            &lt;/servlet&gt;
        &lt;/sun-web-app&gt;
<br></pre>
Once the endpoint is deployed, you can access the liveness of the
service using https protocol (instead of http) as follows and see the <code>&lt;soap:address
location="https://.."&gt;</code> in the wsdl file with https protocol:<br>
<p><code>https://localhost:8181/ssl-jaxws-war/TaxService?wsdl
</code><br>
</p>
<h2><a name="gen_artifacts"></a>Generation of artifacts when endpoint
is secured using https</h2>
In order to compile a client, we need some special files that the Tax
Webservice will give us.
This is required so that the client has the webservice interfaces and
ports available.
We use wsimport, an App Server-supplied program to this and to trust
the server certificate, set the SSL trust store as system property in
the environment variable, VMARGS. See the below snapshot:
<p><code><br>
set
VMARGS=-Djavax.net.ssl.trustStore=${javaee.domaindir}/config/cacerts.jks
<br>
where cacerts.jks is the default trust store for the application
server.
<br>
<br>
${javaee.home}/bin/wsimport -d ./build
http://${javaee.server.name}:${javaee.server.port}/ssl-jaxws-war/TaxService?wsdl"/&gt;<br>
<br>
</code></p>
<h2><a name="runtime"></a>Runtime environment of the AppClient
during&nbsp; secured
https access to WS<br>
</h2>
The appclient runtime environment should have the SSL truststore path
to be set in VMARGS environment variable before running the client. You
can run the client like this:<br>
<p><code>set
VMARGS=-Djavax.net.ssl.trustStore=${javaee.domaindir}/config/cacerts.jks
<br>
cd ./build
<br>
${javaee.home}/bin/appclient
webservices.ssl_jaxws_appclient.TaxCalClient income deductions </code>
</p>
<p></p>
<p>In order to debug whether SSL is involved or not, you can add <code>-Djavax.net.debug=SSL,handshake&nbsp;</code>
(JSSE system property) to VMARGS. During runtime you can see all the
activities of ssl handshake.</p>
<br>
<h2><a name="sources_build"></a>Source code and instructions for
building and running the sample<br>
</h2>
<p>The source code can be viewed by clicking the links
-&nbsp; <a
 href="../ssl-jaxws-war/src/java/webservices/ssl_jaxws_war/Tax.java">jax-ws
web service</a>, <a
 href="../ssl-jaxws-appclient/src/java/webservices/ssl_jaxws_appclient/TaxCalClient.java">client</a>
.<br>
</p>
<p>The sample building, runtime has been done using the ANT framework
and see the <a href="../../docs/UserREADME.html">common instructions</a>
for steps.&nbsp;&nbsp; Running "ant" at &lt;ssl-jaxws-ear&gt; directory
does build, deploy of the web service and run the client. <br>
</p>
<p>The following are the break down steps may help in understanding
application pieces.<br>
</p>
<ol>
  <li>
    <p>Build and deploy webservice alone:&nbsp; <code>cd
ssl-jaxws-ear/ssl-jaxws-war; ant</code></p>
  </li>
  <li><code></code>Run javaee standalone client build and run : <code>cd
ssl-jaxws-ear/ssl-jaxws-appclient; ant</code></li>
  <li>
    <p><code></code>Run javase junit test: <code>cd
ssl-jaxws-ear/ssl-jaxws-test; ant</code></p>
  </li>
</ol>
<p></p>
<p>Sample snapshot of client runtime is as follows.<br>
</p>
<p>The client will print out the income, deductions and federal tax.
<code><br>
</code><code>${javaee.home}/bin/appclient</code><code>
webservices.ssl_jaxws_appclient.TaxCalClient 80000 3000
<br>
Invoking TaxService...
<br>
Income=80000.0
<br>
Deductions=3000.0
<br>
Federal tax=15400.0<br>
</code></p>
<h2>Troubleshooting</h2>
<p>If you have problems when running the application, refer to <a
 href="../../../docs/UserTroubleShooting.html">
troubleshooting document</a>.
</p>
<br>
If you hit the following certificate error, then please make sure
VMARGS (for appclient) or -Djavax.net.ssl.trustStore (for java se
client) environment has the trust store path.<code><br>
javax.xml.ws.WebServiceException: HTTP transport error:
javax.net.ssl.SSLHandshakeException:
sun.security.validator.ValidatorException: No trusted certificate found
</code><br>
<br>
<p></p>
</body>
</html>
